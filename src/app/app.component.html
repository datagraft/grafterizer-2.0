<div class="main-container">
  <header class="header-6">
    <div class="branding" *ngIf="!showWizardNavigation">
      <a href="/" class="nav-link">
        <img *ngIf="showLogo" src="/assets/logo.png" height="24" width="48">
        <span class="title">
          <strong>Grafterizer 2.0</strong>
        </span>
      </a>
    </div>
    <div class="header-nav">
      <a routerLink="/{{grafterizerUrl}}tabular-transformation" routerLinkActive="active" class="nav-link">
        <span class="nav-text">Tabular Transformation</span>
      </a>
      <a routerLink="/{{grafterizerUrl}}rdf-mapping" routerLinkActive="active" class="nav-link">
        <span class="nav-text">RDF Mapping</span>
      </a>
      <a *ngIf="showTabularAnnotationTab" routerLink="/{{grafterizerUrl}}tabular-annotation" routerLinkActive="active"
        class="nav-link">
        <span class="nav-text">Tabular Annotation</span>
      </a>
      <!--       <a routerLink="/transformation/new/data-exploration" routerLinkActive="active" class="nav-link">
      <span class="nav-text">Data Exploration</span>
      </a> -->
    </div>
    <div class="header-actions">
      <a *ngIf="showSaveButton" href="javascript://" (click)="save(false)" title="Save" class="sin-nav-icon">
        <i class="material-icons md-light">save</i>
      </a>
      <a *ngIf="showForkButton" href="javascript://" (click)="fork()" title="Copy" class="sin-nav-icon">
        <i class="material-icons md-light md-22">file_copy</i>
      </a>
      <a *ngIf="showDownloadButton" href="javascript://" (click)="showDownloadDialog = true" title="Download"
        class="sin-nav-icon">
        <i class="material-icons md-light">get_app</i>
      </a>
      <a *ngIf="showDeleteButton" href="javascript://" (click)="showConfirmDeleteDialog = true" title="Delete"
        class="sin-nav-icon">
        <i class="material-icons md-light">delete</i>
      </a>
      <button mat-raised-button *ngIf="showWizardNavigation" (click)="goBack()"
        class="sin-datagraft-wizard-button">Back</button>
      <button mat-raised-button *ngIf="showWizardNavigation" (click)="openNextStepConfirmation()"
        class="sin-datagraft-wizard-button">Next
        step</button>
    </div>
  </header>
  <clr-alerts>
    <clr-alert class="alerts" [clrAlertType]="'danger'" [clrAlertClosable]="false" [clrAlertAppLevel]="true"
      *ngFor="let error of globalErrors; let i = index">
      <div class="alert-item">
        <span class="alert-text">
          Woops - something went wrong! If the problem persists, try reloading the application.
          <br /> {{error.toString().substring(0,200) + " [...]"}}
        </span>
        <div class="alert-actions">
          <button class="btn alert-action" (click)="onClose(i)">Close</button>
        </div>
      </div>
    </clr-alert>
  </clr-alerts>
  <div class="content-container">
    <router-outlet></router-outlet>
    <div style="height: 100%" fxLayout="column" fxLayoutAlign="center center" [hidden]="!showLoading">
      <div class="spinner">
        <span class="spinner spinner-lg" fxflex>
          Loading...
        </span>
      </div>
    </div>
    <div *ngIf="showLoadDistributionDialog" class="load-distribution">
      <div id="btn">
        <button mat-fab (click)="loadDistribution()" matTooltip="Select an existing file from your DataGraft assets">
          <mat-icon aria-label="Upload a file locally from your computer">cloud</mat-icon>
        </button>
      </div>
      <div id="btn">
        <button mat-fab (click)="fileInput.click()" matTooltip="Upload a file locally from your computer">
          <mat-icon aria-label="Upload a file locally from your computer">folder_open</mat-icon>
          <input hidden type="file" id="fileSelect" #fileInput (change)="onFileChange($event)" />
        </button>
      </div>
    </div>
  </div>
</div>

<clr-modal *ngIf="showLoadDistributionDialog" [(clrModalOpen)]="modalEnabled" [clrModalClosable]="false"
  [clrModalSize]="'lg'">
  <h3 class="modal-title">Load existing file</h3>
  <div class="modal-body">
    <div fxLayout='column' fxLayoutAlign="left">
      <p-listbox [options]="distributionList" [(ngModel)]="selectedFile" (ngModelChange)="onChange($event)"
        [styleClass]="ui-state-active"
        [style]="{'width':'800px', 'background-color':'white', 'border':'1px solid grey'}"
        [listStyle]="{'height':'360px'}">
      </p-listbox>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline" (click)="cancel()">Cancel</button>
    <button type="button" class="btn btn-primary" (click)="accept()">OK</button>
  </div>
</clr-modal>

<clr-modal [(clrModalOpen)]="showConfirmNextStepDialog" [clrModalClosable]="false">
  <h3 class="modal-title">Are you sure you want to continue?</h3>
  <div class="modal-body">
    <div class="radio">
      <input type="radio" [(ngModel)]="transformationType" value="pipe" id="mode_1">
      <label for="mode_1">Save as file</label>
    </div>
    <div class="radio">
      <input type="radio" [(ngModel)]="transformationType" value="graft" id="mode_2">
      <label for="mode_2">Save as graph in a SPARQL endpoint</label>
    </div>
    <br>
    <!-- <mat-progress-spinner [hidden]="fillingWizard" mode="indeterminate" diameter="50px" style="margin: auto;">
    </mat-progress-spinner> -->
    <div>
      <div *ngIf="loadingNextStepMessage && fillingWizard">{{loadingNextStepMessage}}</div>
      <div *ngIf="!fillingWizard">{{nextStepDialogMessage}}</div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline" (click)="cancelNextStep()" [disabled]="fillingWizard">Cancel</button>
    <button type="button" class="btn btn-primary" (click)="goNextStep()" [disabled]="fillingWizard">Confirm</button>
  </div>
</clr-modal>

<clr-modal [(clrModalOpen)]="showDownloadDialog" [clrModalClosable]="false">
  <h3 class="modal-title">Choose download option:</h3>
  <div class="modal-body">
    <div class="sin-download-dialog-body">
      <div class="sin-download-dialog-choices">
        <div class="radio">
          <input type="radio" [(ngModel)]="downloadMode" value="csv" id="mode_1">
          <label for="mode_1">Download result as CSV</label>
        </div>
        <div class="radio">
          <input type="radio" [(ngModel)]="downloadMode" value="rdf" id="mode_2">
          <label for="mode_2">Download result as RDF</label>
        </div>
        <div class="radio">
          <input type="radio" [(ngModel)]="downloadMode" value="arango-json" id="mode_4">
          <label for="mode_4">Download result as ArangoDB JSON collections</label>
        </div>
        <div class="radio">
          <input type="radio" [(ngModel)]="downloadMode" value="jar" id="mode_3">
          <label for="mode_3">Download executable JAR file</label>
        </div>
        <div class="radio">
          <input type="radio" [(ngModel)]="downloadMode" value="grafterizer-json" id="mode_5">
          <label for="mode_5">Download transformation JSON</label>
        </div>
      </div>
      <div class="sin-download-dialog-options" *ngIf="downloadMode == 'rdf' || downloadMode == 'jar'">
        <div *ngIf="downloadMode == 'rdf'">
          <label for="rdf-format" class="clr-control-label">Choose output format: </label>
          <div class="clr-select-wrapper">
            <select clrSelect id="rdf-format" [(ngModel)]="chosenRdfFormatDownloadOption">
              <!-- Note: Currently the Graftwerk backend only supports N-Triples. 
                The serialiser does support other formats, but they have been hacked out in Graftwerk. -->
              <option value="nt">N-Triples</option>
              <!-- <option value="nq">N-Quads</option>
              <option value="ttl">Turtle</option>
              <option value="rdf+xml">RDF/XML</option>
              <option value="n3">N3</option>
              <option value="trix">TRiX</option>
              <option value="trig">TRiG</option>
              <option value="jsonld">JSON-LD</option> -->
            </select>
          </div>
        </div>
        <div *ngIf="downloadMode == 'jar'">
          <label for="jar-option" class="clr-control-label">Choose JAR file output: </label>
          <div class="clr-select-wrapper">
            <select clrSelect id="jar-option" [(ngModel)]="chosenRdfFormatDownloadOption">
              <option value="nt">N-Triples</option>
            </select>
            <button aria-label="Usage: java -jar transformation.jar <input-file.csv> <output-file.(nt|
              rdf|n3|ttl)><output-file.>" matTooltip="Usage: java -jar transformation.jar <input-file.csv> <output-file.(nt|
                rdf|n3|ttl)><output-file.>">
              <mat-icon>info</mat-icon>
            </button>

          </div>
        </div>
      </div>
    </div>

  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline" (click)="showDownloadDialog = false">Cancel</button>
    <button type="button" class="btn btn-primary" (click)="download()">OK</button>
  </div>
</clr-modal>

<clr-modal [(clrModalOpen)]="showConfirmDeleteDialog" [clrModalClosable]="false">
  <h3 class="modal-title">Are you sure you want to delete the transformation?</h3>
  <br>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline" (click)="showConfirmDeleteDialog = false"
      [disabled]="downloadingResult">Cancel</button>
    <button type="button" class="btn btn-primary" (click)="delete()" [disabled]="downloadingResult">Confirm</button>
  </div>
</clr-modal>